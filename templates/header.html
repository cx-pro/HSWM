<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
<!-- jquery-ui -->
<link href="https://code.jquery.com/ui/1.13.1/themes/smoothness/jquery-ui.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js" crossorigin="anonymous"></script>
<!--------------->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

<link href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/plugins/buffer.min.js"
  type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/plugins/filetype.min.js"
  type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/fileinput.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/locales/LANG.js"></script>
<link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/css/fileinput.min.css" media="all"
  rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">

<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
  /* Hide scrollbar for Chrome, Safari and Opera */
  *::-webkit-scrollbar {
    width: .5rem;
  }

  *::-webkit-scrollbar-thumb {
    border: #e9ecef solid .1rem;
    border-radius: .8rem;
    -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
    background-color: #4285F4;
  }

  /* *::-webkit-scrollbar:horizontal {
      height: .5rem;
    } */
  *::-webkit-scrollbar:horizontal {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  * {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
  }
</style>
<header class="py-4 mb-1 border-bottom user-select-none text-start shadow-sm border-bottom z-3"
  style="background-color:inherit;" id="true-header">
  <div class="container-fluid d-grid gap-3 align-items-center" style="grid-template-columns: 1fr 2fr;">
    <a href="/"
      class="dropdown d-flex flex-row align-middle align-items-start p-0 w-50 m-auto pe-auto text-decoration-none user-select-auto">
      <img src="/static/pics/new_logo1.png" class="me-0 me-md-3" style="width:2.5rem;height:100%;">
      <font class="fw-bold fs-3 d-none flex-row align-middle justify-content-center ms-5 d-md-flex" id="alpha"
        style="width:3rem;height:100%;">
        <font class="text-primary">高</font>
        <font class="text-primary">中</font>
        <font class="text-primary">職</font>
        <font class="text-primary">小</font>
        <font class="text-primary">幫</font>
        <font class="text-primary">手</font>
        <!-- <small class="text-primary small fs-6 pt-3">Alpha</small> -->
      </font>
    </a>
    <div class="d-flex align-items-center ms-auto">
      <div class="w-100 me-3 me-md-5 text-end d-flex">
        <div id="network-status" class="fs-3 me-3 me-xl-5 fw-bold" data-bs-placement="bottom" data-bs-toggle="tooltip"
          data-bs-title="網路狀態" data-bs-custom-class="custom-tooltip"></div>
        <label id="darkl" class="theme user-select-none fw-bold fs-3" style="cursor:pointer;"><i class="bi bi-moon-fill"
            id="dark"></i></label>
        <label id="lightl" class="theme user-select-none fw-bold fs-3" style="cursor:pointer;"><i
            class="bi bi-brightness-high-fill" id="light"></i></label>
      </div>
      <div class="dropdown">
        {%if not current_user.is_qrcUser%}
        <a class="me-2 text-decoration-none" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-grid-3x3-gap-fill fs-3" style="cursor:pointer;"></i>
        </a>
        {%endif%}
        <div class="dropdown-menu dropdown-menu-end rounded-2 border-2 shadow" style="width:25rem;max-width:95vw;">
          <div class="row px-auto g-0 text-center w-100 overflow-y-scroll fw-bold"
            style="min-height: 10rem;max-height:100vh;">
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/"
                class="btn border-0 text-center border-0 {%if request.path=='/'%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="bi fs-1 bi-house"></div>
                首頁
              </a>
            </div>

            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/certi/"
                class="btn border-0 text-center border-0 {%if '/certi/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                <div class="bi fs-1 bi-filetype-pdf"></div>
                數位獎狀

              </a>
            </div>

            {%if current_user.is_authenticated%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/profile"
                class="btn border-0 text-center border-0 {%if request.path=='/profile'%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="fs-1 rounded-circle"><img
                    class="rounded-circle border-2 {%if request.path=='/profile'%}border-primary{%else%}border-secondary{%endif%} border"
                    src="{%if not current_user.avatar.startswith('http')%}/static/{%endif%}{{current_user.avatar}}"
                    style="max-width:3.5rem;" alt=""></div>
                <font style="vertical-align: inherit;">
                  <font style="vertical-align: inherit;">
                    個人檔案
                  </font>
                </font>
                <!-- <span class="badge rounded-pill bg-danger">
                    自訂頭像!!
                    <span class="visually-hidden">unread messages</span>
                  </span> -->
              </a>
            </div>

            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/chat/"
                class="btn border-0 text-center border-0 {%if '/chat/' in request.path%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="bi fs-1 bi-chat-right-text"></div>
                聊聊天
              </a>
            </div>
            {%endif%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/tools/meet_confirm" style="cursor:pointer"
                class="btn border-0 text-center border-0 {%if '/tools/meet' in request.path%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="bi bi-camera fs-1"></div>
                創建 Meet
              </a>
            </div>
            {%if current_user.is_student%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/sche/"
                class="btn border-0 text-center border-0 {%if '/sche/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                <div class="bi fs-1 bi-ui-checks"></div>
                班級行事曆

              </a>
            </div>
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/grade/"
                class="btn border-0 text-center border-0 {%if '/clsm/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                <div class="bi fs-1 bi-graph-up"></div>
                成績

              </a>
            </div>
            {%endif%}
            {%if current_user.is_asistnt%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/tskn/"
                class="btn border-0 text-center border-0 {%if '/tskn/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                <div class="bi fs-1 bi-calendar-plus"></div>
                班級排程

              </a>
            </div>
            {%endif%}
            {%if current_user.is_teacher%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/tskn/"
                class="btn border-0 text-center border-0 {%if '/tskn/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                <div class="bi fs-1 bi-calendar-plus"></div>
                班級排程

              </a>
            </div>
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/clsm/"
                class="btn border-0 text-center border-0 {%if '/clsm/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                <div class="bi fs-1 bi-building-gear"></div>
                班級管理

              </a>
            </div>
            <!-- <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
                <a href="/exam/create" class="btn border-0 text-center border-0 {%if '/exam/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                  <div class="bi bi-journal-plus fs-1"></div>
                  考試管理
                  <span class="badge rounded-pill bg-primary">
                    測試
                    <span class="visually-hidden">unread messages</span>
                  </span>
                </a>
              </div> -->
            {%endif%}
            {%if current_user.is_admin%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/adm/"
                class="btn border-0 text-center border-0 {%if '/adm/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                <div class="bi fs-1 bi-speedometer2"></div>
                管理者系統
              </a>
            </div>
            {%endif%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/qa/qas"
                class="btn border-0 text-center border-0 {%if '/qa/' in request.path %}fw-bold text-primary{%else%}text-muted{%endif%}">
                <div class="bi fs-1 bi-quote"></div>
                課業問與答
              </a>
            </div>

            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/login_help"
                class="btn border-0 text-center border-0 {%if request.path in['/login_help','/help0','/help1','/help2']%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="bi fs-1 bi-gear"></div>
                登入協助
              </a>
            </div>
            {%if current_user.is_authenticated%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/notifications"
                class="btn border-0 text-center border-0 {%if request.path=='/notifications'%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="bi fs-1 bi-app-indicator"></div>
                通知
              </a>
            </div>
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/settings"
                class="btn border-0 text-center border-0 {%if request.path=='/settings'%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="bi fs-1 bi-gear"></div>
                設置
                {%if not current_user.is_admin%}
                <!-- <br>
                  <div class="badge rounded-pill bg-danger">
                    新功能!!
                    <span class="visually-hidden">unread messages</span>
                  </div> -->
                {%endif%}
              </a>
            </div>
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/logout"
                class="btn border-0 text-center border-0 {%if request.path=='/logout'%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="bi fs-1 bi-box-arrow-right"></div>
                <font style="vertical-align: inherit;">
                  <font style="vertical-align: inherit;">
                    登出
                  </font>
                </font>
              </a>
            </div>
            {%else%}
            <div class="col-4 py-0 my-0" style="max-height:10rem !important;">
              <a href="/login"
                class="btn border-0 text-center border-0 {%if request.path=='/login'%}fw-bold text-primary{%else%}text-muted{%endif%}"
                aria-current="page">
                <div class="bi fs-1 bi-box-arrow-in-right"></div>
                <font style="vertical-align: inherit;">
                  <font style="vertical-align: inherit;">
                    登入/註冊
                  </font>
                </font>
              </a>
            </div>
            {%endif%}
          </div>
        </div>
      </div>
      <!-- <div class="flex-shrink-0 me-2" style="cursor: pointer;" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight" >
          <i class="bi bi-list fw-bold fs-1"></i>
        </div> -->
      <p></p>
    </div>
  </div>
</header>
<!-- <marquee class="bg-primary-subtle border-top border-bottom border-primary fw-bold w-100 text-light-subtle overflow-x-scroll p-1 text-nowrap" scrollamount="3" style="height:2rem;">頁面若經常在加載後要求登入，則為製作者修改程式後重啟系統造成，非常抱歉。</marquee> -->

<script>
  function aja(key) {
    $.ajax({
      url: "/rs",
      method: "post",
      data: { "key": key }
    });
  };
  function ajx(mode) {
    $.ajax({
      url: "/qa/set_s",
      method: "post",
      data: { "mode": mode }
    });
  };
  $(function () {
    // var socket = io.connect('https://' + document.domain + ':' + location.port);
    // socket.on('reload', function() {
    //   location.reload();
    // });
    $("head").append(`<link rel="manifest" href="/static/dependences/others/manifest.json" />`)

    navigator.serviceWorker.register('/static/dependences/others/sw.js')
      .then(reg => console.log('SW registered!', reg))
      .catch(err => console.log('Boo!', err));

    $("#network-status").html(`${navigator.onLine ? '<i class="bi bi-wifi text-success"></i>' : '<i class="bi bi-wifi-off text-danger"></i>'}`)
    $("#network-status").attr("data-bs-title", `${navigator.onLine ? "線上" : "離線"}`)
    $("#network-status").attr("data-bs-custom-class", `${navigator.onLine ? "success-tooltip" : "danger-tooltip"}`)
    function updateOnlineStatus(event) {
      $("#network-status").html(`${navigator.onLine ? '<i class="bi bi-wifi text-success"></i>' : '<i class="bi bi-wifi-off text-danger"></i>'}`)
      $("#network-status").attr("data-bs-title", `${navigator.onLine ? "線上" : "離線"}`)
      $("#network-status").attr("data-bs-custom-class", `${navigator.onLine ? "success-tooltip" : "danger-tooltip"}`)
      tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
      popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
      popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
      toastElList = document.querySelectorAll('.toast')
      toastList = [...toastElList].map(toastEl => new bootstrap.Toast(toastEl))
    }
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);

    fake_session = "{{session['dark']}}";
    if (fake_session) {
      $("html").attr("data-bs-theme", fake_session);
    };
    if ($("html").attr("data-bs-theme")) {
      $("#" + fake_session + "l").hide();
    };
    $(document).on('click', '.theme', function (e) {
      let chld = $(this).children("i").attr("id");
      let m = { "light": "dark", "dark": "light" };
      // alert(chld);
      ajx(chld);
      $("html").attr("data-bs-theme", chld)
      fake_session = chld;
      $("#" + chld + "l").hide();
      $("#" + m[chld] + "l").show();
      // if(!$("head").html().includes(`<meta name="theme-color" content="blue" media="(prefers-color-scheme: dark)">`)){
      //   $("head").append(`<meta name="theme-color" content="blue" media="(prefers-color-scheme: dark)">`)
      // }
    });
  });
</script>
<style>
  .custom-tooltip {
    --bs-tooltip-bg: var(--bs-primary);
    font-weight: bold;
  }

  .primary-tooltip {
    --bs-tooltip-bg: var(--bs-primary);
    font-weight: bold;
  }

  .danger-tooltip {
    --bs-tooltip-bg: var(--bs-danger);
    font-weight: bold;
  }

  .warning-tooltip {
    --bs-tooltip-bg: var(--bs-warning);
    font-weight: bold;
  }

  .success-tooltip {
    --bs-tooltip-bg: var(--bs-success);
    font-weight: bold;
  }
</style>
<script>
  $(() => {
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
    const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
    const toastElList = document.querySelectorAll('.toast')
    const toastList = [...toastElList].map(toastEl => new bootstrap.Toast(toastEl))
  })
</script>


<div id="loader_container"></div>
<script>
  $(() => {
    $(window).off("unload").on("unload", function () {
      $("#loader_container").html("")
    })
    const loader = `<div class="bg-{{session.get('dark','light')}} position-fixed top-0 start-0 opacity-50" style="height:100vh;width:100vw;z-index:999999" id="page_loader"><div class="spinner-grow text-primary position-fixed top-50 start-50 translate-middle" role="status">
  <span class="visually-hidden">Loading...</span>
</div></div>`
    $(window).off("beforeunload").on("beforeunload", function () {
      $("#loader_container").html(loader)
    })
  })
</script>
{%if not current_user.is_authenticated and not request.path in ['/usage','/login','/line_login'] and not "/food" in
request.path%}
<div id="g_id_onload" class="position-absolute bottom-0 start-0"
  data-client_id="414226323929-i0qk8daa5gshv0p5fv5bjqf2mqjfi930.apps.googleusercontent.com" data-context="signin"
  data-login_uri="https://hswm.up.railway.app/google_callback?next={{request.full_path if request.args and request.full_path else request.path if not request.args else '/'}}"
  data-prompt_parent_id="g_id_onload" data-itp_support="true">
</div>
{%endif%}